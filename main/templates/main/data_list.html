{% extends 'main/base.html' %}
{% load filters %}
{% block content %}

{% if entry_list %}
<div class="alert alert-success">Found <span class="badge">{{num_entries}}</span> Entries!
<a class="close" data-dismiss="alert" href="#" aria-hidden="true">&times;</a>
</div>
{% else%}
<div class="alert alert-warning">No Results Found!
<a class="close" data-dismiss="alert" href="#" aria-hidden="true">&times;</a>
</div>
{% endif %}

<div class="well">





<form enctype="multipart/form-data" method="post" class="form-inline" role="form" action="{% url "view" %}">
{% csrf_token %}
    <input type="hidden" name="plates" id="selector-target">
    <div class="form-group">
        <input type="submit" value="Update" class="btn btn-primary">
    </div>
    <div class="form-group">
        <select name="field" class="form-control">
            {% for i in field_list %}
                <option value="{{i}}">{{ i }}</option>
            {% endfor %}
        </select>


        <select name="sign" class="form-control">
                <option value="exact">=</option>
                <option value="gt">></option>
                <option value="gte">>=</option>
                <option value="lt"><</option>
                <option value="lte">>=</option>
                <option value="iexact">like</option>
                <option value="icontains">contain</option>
        </select>
    </div>

    <div class="form-group"> 
        <input type="text" name="querytext" id="query1" class="form-control">
    </div>

    (

    <div class="form-group">
        <select name="joint" class="form-control">
                 <option value=""></option>
                <option value=",">AND</option>
                <option value="|">OR</option>
                <option value=",~">NOT</option>
        </select>
        

        <select name="field2" class="form-control">
            {% for i in field_list %}
                <option value="{{i}}">{{ i }}</option>
            {% endfor %}
        </select>

        <select name="sign2" class="form-control">
                <option value="exact">=</option>
                <option value="gt">></option>
                <option value="gte">>=</option>
                <option value="lt"><</option>
                <option value="lte">>=</option>
                <option value="iexact">like</option>
                <option value="icontains">contain</option>
        </select>
    </div>
    <div class="form-group">
        <input type="text" name="querytext2"  class="form-control">

    </div>
    )

</form>

</div>

{% if entry_list %}


<ul class="pagination">
    <li class="{{pbutton_attr}}"><a href='?page=1'>First</a></li>
    <li class="{{pbutton_attr}}"><a href='?page={{prev_page}}'>Prev</a></li>
    {% for i in pages %}
    <li class="{% if i == curr_page %}active{% endif %}"><a href='?page={{i}}'>{{i}}</a></li>
    {% endfor %}
    <li class="{{pbutton_attr}}"><a href='?page={{next_page}}'>Next</a></li>
    <li class="{{pbutton_attr}}"><a href='?page={{last_page}}'>Last</a></li>
</ul>


<table class="table table-striped table-hover table-condensed table-responsive" id="list">

    <tr>
        <td></td>
        {% for i in field_list %}
            <td>
                <strong><a href='?order={% if i == pre_order %}-{% endif %}{{i}}'>{{ i|title }}</a></strong>
            </td>
        {% endfor %}
    </tr>

    {% for j in entry_list %}
        <tr>
            <td>{% if j.welltype == "X" %}
                <button class="btn btn-default btn-xs cmpdTrigger" plate="{{j.plate}}" well="{{j.well}}">view</button>
                {% endif %}
            </td>
            {% for i in field_list %}
                <td>
                    {{ j|getattr:i|tabler }}

                </td>
            {% endfor %}
        </tr>
    
    {% endfor %}

</table>

<ul class="pagination">
    <li class="{{pbutton_attr}}"><a href='?page=1'>First</a></li>
    <li class="{{pbutton_attr}}"><a href='?page={{prev_page}}'>Prev</a></li>
    {% for i in pages %}
    <li class="{% if i == curr_page %}active{% endif %}"><a href='?page={{i}}'>{{i}}</a></li>
    {% endfor %}
    <li class="{{pbutton_attr}}"><a href='?page={{next_page}}'>Next</a></li>
    <li class="{{pbutton_attr}}"><a href='?page={{last_page}}'>Last</a></li>
</ul>

<div class="modal fade" id="cmpdDetail" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
<div class="modal-dialog">
    <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title">Compound Detail</h4>
        </div>
        <div class="modal-body" id="cmpdContent">


        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary">Add to HitList</button>
        </div>
    </div><!-- /.modal-content-->
</div><!-- /.modal-dialog -->
</div>


{% endif %}

{% endblock %}

{% block script %}
<script>

//$("#cmpdDetail").modal('show');
$(".cmpdTrigger").each(function(){


    $(this).click(function(){
        $("#cmpdContent").html('');
        plate=$(this).attr('plate');
        well=$(this).attr('well');
        
        $.get("/statistics/details/",
            {plate:plate,well:well,t:1},
            function(data){
                $("#cmpdContent").html(data);
            });

        $("#cmpdDetail").modal('show');
        //alert(plate+well);
    });

});

</script>
{% endblock %}