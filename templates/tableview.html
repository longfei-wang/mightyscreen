{% extends 'base.html' %}
{% load staticfiles %}

{% block css %}


{% endblock %}



{% block content %}
<div class="row">
    <div class="col-md-12 col-sm-12" id="plateSelector">
    </div>

</div>


<div class="row">
	<div class="col-md-12 col-sm-12" id="tableview">
	</div>
</div>

{% endblock %}


{% block script %}
<script src='{% static "tablevis.js" %}'></script>
<script src = '{% static "plate_selector.js"%}'></script>
<script>
$(function() {

	var url = '{% url "data-list" %}';
	var thisData = [];
	var MyEventHandler = new Object();

	var wrangleData = function(_data) {

		thisData = $.extend({},_data);

	    thisData.results = _data.results.map(function (d) {
	    
	        var res = {
	            plate_well: d.plate_well,
	            plate:d.plate,
	            well:d.well,
	            welltype:d.welltype,
	            hit:d.hit,
	        };

	        thisData.channels.map(function(c,i){
	            res[c] = parseFloat(d[c]);
	        });

	        return res;
	    });

	}

	var init = function() {

		var tableview =new TableVis(d3.select("#tableview"),thisData,MyEventHandler);	
		
		var plateselector = new PlateSelector(d3.select("#plateSelector"),thisData,MyEventHandler);


		$(MyEventHandler).bind("query", function(event, query){
			console.log(query)
			$.get(url,query,function(d){
				wrangleData(d);
				tableview.onQuery(thisData);
			});
		});

	}

	d3.json(url,function(d){
		wrangleData(d);
		init();
	});

});


</script>

{% endblock %}

