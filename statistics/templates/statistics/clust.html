<style>
.horizontal_selection div {
display: inline-block;
vertical-align: middle;
}
</style>

{% extends 'statistics/index.html' %}
{% load filters %}
{% load staticfiles %}
{% load bootstrap_tags %}

{%block plot-option%}

<form role="form" class="form-horizontal" enctype="multipart/form-data" method="post" action="{% url url_name %}">
{%if url_name == "stat_dendrogram"%}
<!-- block to data column buttons-->
<!--ul class="nav nav-pills data_column" >
    {%for field in field_list%}
        <li class = "btn btn-default" data_column = {{field}} >{{field}}</li>
    {%endfor%}
</ul>
<textarea class = "data_column_to_plot" name= "data_column_to_plot" style="display:none;"></textarea>
<hr-->

<div class= "horizontal_selection">
<div style="width:150px;"><span><strong>Linkage Method:</strong></span></div>
<div style="width:150px;">
    <select name='linkage_method_x' class='form-control'>
        <option value= 'complete'>complete</option>
        <option value= 'single'>single</option>
        <option value= 'average'>average</option>    
    </select>
</div>
</div><br>

<div class= "horizontal_selection">    
<div style="width:150px;"><span><strong>Group By:</strong></span></div>
<div style="width:150px;">
    <select name='dendro_color_by_x' class='form-control' id= "dendro_color_by_x">
        <option value= 'similarity'>Similarity Cutoff</option>
        <option value= 'bin'>Bins</option>
    </select>
</div>


<div style="width:80px;">
<select name='dendro_color_value_similarity_x' id ='dendro_similarity_x' class='form-control similarity_choice'>
    {%with '0.9 0.8 0.7 0.6 0.5 0.4 0.3 0.2 0.1' as list%}
    {%for i in list.split reversed %}
    <option value= {{i}}>{{i}}</option>
    {%endfor%}
    {%endwith%}
</select>
<select name='dendro_color_value_bin_x' id='dendro_bin_x' class='form-control bin_choice' style="display: none;">
    {%with '10 9 8 7 6 5 4 3 2' as list%}
    {%for i in list.split reversed %}
    <option value= {{i}}>{{i}}</option>
    {%endfor%}
    {%endwith%}
</select>
</div>

</div>
<hr>    
{%endif%}


{%if url_name == "stat_2ddendrogram"%}
{%for j in 'xy'%}
<div class= "horizontal_selection">
<div><span class="label label-info">{{j|upper}}</span></div>
<div><span><strong>Linkage Method:</strong></span></div>
<div style="width:150px;">
    <select name='linkage_method_{{j}}' class='form-control'>
        <option value= 'complete'>complete</option>
        <option value= 'single'>single</option>
        <option value= 'average'>average</option>    
    </select>
</div>
  
<div><span><strong>Group By:</strong></span></div>
<div style="width:150px;">
    <select name='dendro_color_by_{{j}}' class='form-control' id= "dendro_color_by_{{j}}">
        <option value= 'similarity'>Similarity Cutoff</option>
        <option value= 'bin'>Bins</option>
    </select>
</div>


<div style="width:80px;">
<select name='dendro_color_value_similarity_{{j}}' id ='dendro_similarity_{{j}}' class='form-control similarity_choice'>
    {%with '0.9 0.8 0.7 0.6 0.5 0.4 0.3 0.2 0.1' as list%}
    {%for i in list.split reversed %}
    <option value= {{i}}>{{i}}</option>
    {%endfor%}
    {%endwith%}
</select>
<select name='dendro_color_value_bin_{{j}}' id='dendro_bin_{{j}}' class='form-control bin_choice' style="display: none;">
    {%with '10 9 8 7 6 5 4 3 2' as list%}
    {%for i in list.split reversed %}
    <option value= {{i}}>{{i}}</option>
    {%endfor%}
    {%endwith%}
</select>
</div>
</div>
<br>
{%endfor%}
<hr>  



<div class= "horizontal_selection">    
<div style="width:150px;"><span><strong>Heatmap color:</strong></span></div>
<div style="width:150px;">
<select name='heatmap_color' class='form-control'>
    <option value= 'YlGnBu'>YlGnBu</option>
    <option value= 'YlGnBu_r'>YlGnBu Reverse</option>
    {%for cmap in cmap_list%}
    <option value= {{cmap}}>{{cmap}}</option>
    <option value= {{cmap}}_r>{{cmap}} Reverse</option>
    {%endfor%}
</select>
</div>
</div>
<hr>
{%endif%}





<div class="well">
{% csrf_token %}   
    {{form|as_bootstrap_h}}       
    <div class="form-group">
        <div class="col-sm-offset-2 col-sm-10">
            <button type="submit" class="btn btn-success">Plot</button>
            <!--button type="reset" class="btn btn-default">Clear</button-->
        </div>
    </div>   
</div>

</form> 
{%endblock%}





{% block plot-img %}
<div class= 'img_list'>
    {%if img_list|length == 0%}
        <div class="alert alert-success"><h4> Please select plates </h4></div>
    {%else%}
    {%for img in img_list%}
        <hr>
        <section class= 'img'>
            <div class= "parent">
            <div class= "panzoom">
            {{img|safe}}
            </div>
            </div><br>          
            <div class="buttons">
                <button class="btn btn-info panzoom-zoom-in">Zoom In</button>
                <button class="btn btn-info panzoom-zoom-out">Zoom Out</button>
                <input type="range" class="panzoom-zoom-range">
                <button class="btn btn-info panzoom-reset">Reset</button>
            </div>
        </section>
    {% endfor %}
    {%endif%}
</div>


<div class="modal fade" id="cmpdDetail" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
<div class="modal-dialog">
    <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title">Compound Detail</h4>
        </div>
        <div class="modal-body" id="heatmapContent">


        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary">Add to HitList</button>
        </div>
    </div><!-- /.modal-content-->
</div><!-- /.modal-dialog -->
</div>

{% endblock %}




{% block script-tooltip %}
<script>
//$("#cmpdDetail").modal('show');

var $patch = $("g[id^='patch_ax']");

$patch.click(function(){
    $("#heatmapContent").html('');
    
    info=$(this).attr("id").split('_');
    plate = info[info.length-2]
    well = info[info.length-1]
    
    $.get("/statistics/details/",
        {plate:plate, well:well,t:1},
        function(data){
            $("#heatmapContent").html(data);
        });
    $("#cmpdDetail").modal('show');
    //alert(plate+well);
});
</script>

<script>
// show different dropdown menu for different color by options
{%for a in 'xy'%}
$('#dendro_color_by_{{a}}').change(function(){

    if ($(this).val() == "similarity"){
        $("#dendro_similarity_{{a}}").show()
        $("#dendro_bin_{{a}}").hide()
    }
   else if ($(this).val() == "bin") {
        $("#dendro_similarity_{{a}}").hide()
        $("#dendro_bin_{{a}}").show()
    }
})
{%endfor%}
</script>


{% endblock %}

{% block script-zoom %}
<script src="{% static "main/js/jquery.panzoom.js" %}"></script>
<script>
var $section = $('section.img');
$section.mouseover(function() {
    a = $(this)
    a.find('.panzoom').panzoom({
    $zoomIn: a.find(".panzoom-zoom-in"),
    $zoomOut: a.find(".panzoom-zoom-out"),
    $zoomRange: a.find(".panzoom-zoom-range"),
    $reset: a.find(".panzoom-reset")
  });
})();
</script>
{% endblock %}




